# Staring into the Abyss: An Evaluation of Concurrency Control with One Thousand Cores

# ABSTRACT

计算机架构正迈向一个以多核计算为主导的时代，单个芯片上集成数十甚至数百个核心。这种前所未有的片上并行性为系统的可扩展性引入了全新的挑战，而当前的数据库管理系统（DBMS）并未针对这一趋势进行优化。尤其是，随着核心数量的增加，并发控制问题变得愈发严峻。在数百个线程并行执行的环境下，如何高效协调对数据的竞争访问，将直接影响多核架构所带来的性能提升。

为了深入理解当前 DBMS 在面对未来 CPU 架构时的局限性，我们对多核环境下的在线事务处理（OLTP）工作负载的并发控制机制进行了评估。我们在一个基于主存的 DBMS 中实现了七种不同的并发控制算法，并利用计算机模拟技术将系统扩展至 1024 核心。**实验结果表明，所有算法在这一规模下均未能成功扩展，但失败的原因各不相同。**在每种情况下，我们都识别出了影响可扩展性的核心瓶颈，并指出这些瓶颈独立于具体的数据库实现，即便是最先进的 DBMS 也难以避免。

基于这一研究，我们认为，与其继续追求渐进式优化方案，不如从根本上重新设计 DBMS 架构，使其与多核硬件深度协同，从底层构建一个面向多核时代的数据库系统。

# 1. INTRODUCTION

单线程性能指数级增长的时代已经结束。由于功耗限制和架构复杂性问题，芯片设计正在从单核架构转向多核架构。尽管时钟频率在过去几十年里持续增长，但如今已趋于停滞。过去那种复杂的、乱序执行的超标量处理器正逐步被简单的、顺序执行的单发射核心所取代。我们正迈入一个“多核计算”时代，在这种架构下，单个芯片上集成了大量低功耗的小型核心。在当前功耗受限、单线程计算效率低下的情况下，除非出现颠覆性的技术变革，增加核心数量是架构师提升计算能力的唯一现实选择。这意味着，指令级并行和单线程性能将让位于大规模的线程级并行计算。

随着摩尔定律的持续推进，单个芯片上的核心数量预计将继续呈指数级增长。不久之后，我们或将迎来百核甚至千核的处理器架构。在这种背景下，单节点共享内存数据库管理系统（DBMS）的可扩展性变得尤为关键。然而，如果当前数据库技术无法适应这一变化，那么这些计算资源将因架构瓶颈而被浪费，多余的核心也将形同虚设。

本文旨在探讨这种未来场景，并分析在千核架构下事务处理系统将面临的挑战。我们并未涵盖所有可能的可扩展性问题，而是聚焦于数据库系统的关键组件之一——并发控制。随着数百个线程的并行运行，对数据访问进行协调的复杂性将成为可扩展性的主要瓶颈，并可能抵消多核架构带来的计算性能提升。因此，我们希望通过深入研究并发控制机制，全面评估 OLTP 数据库系统的可扩展性。

为此，我们在一个基于主存的数据库系统中实现了七种不同的并发控制算法，并利用高性能分布式 CPU 模拟器将系统扩展至 1000 核心。通过从零开始实现系统，我们能够避免现有数据库系统中可能存在的架构性瓶颈，从而更清晰地揭示算法本质上的可扩展性问题。以往的可扩展性研究大多基于现有数据库系统进行 [24, 26, 32]，但这些系统的许多传统组件并未针对多核 CPU 进行优化。就我们所知，目前尚无研究对多个并发控制算法在千核规模的数据库系统上进行评估。

我们的分析结果表明，所有现有并发控制算法在核心数增加时均难以扩展。在每一种算法的实验中，我们都识别出了影响可扩展性的主要瓶颈，并指出即便是当前最先进的数据库系统也难以避免这些限制。我们认为，解决这一问题需要针对多核架构进行深度协同设计的全新并发控制方案。除了增加核心数量之外，计算机架构师还需要提供硬件级的优化方案，以解决软件难以克服的数据库瓶颈。

本文的主要贡献包括：

- 对七种并发控制机制的可扩展性进行全面评估；
- 首次在 1000 核心架构下对 OLTP 数据库系统进行实验研究；
- 识别出影响并发控制方案的核心瓶颈，并指出这些瓶颈独立于具体数据库系统的实现。

本文余下部分的结构如下：第二节概述了我们评估的并发控制方案，第三节介绍了研究的实验组件。第四节和第五节呈现了分析结果，第六节讨论研究发现，第七节回顾相关研究，第八节探讨未来研究方向。

# 2. CONCURRENCY CONTROL SCHEMES

